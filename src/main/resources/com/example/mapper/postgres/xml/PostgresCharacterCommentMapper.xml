<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.postgres.mapper.PostgresCharacterCommentMapper">

    <!-- キャラクターIDでコメント取得 -->
    <select id="selectByCharacterId" resultType="com.example.entity.rdb.RdbCharacterComment">
        SELECT * FROM character_comment WHERE anilist_id = #{anilistId}
    </select>

    <!-- ユーザIDでコメント取得 -->
    <select id="selectByUserId" resultType="com.example.entity.rdb.RdbCharacterComment">
        SELECT * FROM character_comment WHERE user_id = #{userId}
    </select>

    <!-- キャラクターID＆ユーザIDでコメント取得 -->
    <select id="selectByCharacterIdAndUserId" resultType="com.example.entity.rdb.RdbCharacterComment">
        SELECT * FROM character_comment WHERE anilist_id = #{characterId} AND user_id = #{userId}
    </select>

    <!-- シーケンス値取得（PostgreSQLシーケンス名仮） -->
    <select id="getNextSequence" resultType="int">
        SELECT nextval('character_comment_id_seq')
    </select>

    <!-- コメントIDでコメント件数取得 -->
    <select id="selectByCommentId" resultType="int">
        SELECT COUNT(*) FROM character_comment WHERE id = #{id}
    </select>

    <!-- 全件取得 -->
    <select id="selectAll" resultType="com.example.entity.rdb.RdbCharacterComment">
        SELECT * FROM character_comment
    </select>

    <!-- 挿入 -->
    <insert id="insert" parameterType="com.example.entity.rdb.RdbCharacterComment">
        INSERT INTO character_comment (anilist_id, user_id, comment)
        VALUES (#{anilistId}, #{userId}, #{comment})
    </insert>

    <!-- 主キー指定で更新 -->
    <update id="updateByPrimaryKey" parameterType="com.example.entity.rdb.RdbCharacterComment">
        UPDATE character_comment
        SET anilist_id = #{anilistId}, user_id = #{userId}, comment = #{comment}
        WHERE id = #{id}
    </update>

    <!-- 主キー指定で削除 -->
    <delete id="deleteByPrimaryKey" parameterType="long">
        DELETE FROM character_comment WHERE id = #{id}
    </delete>

</mapper>


